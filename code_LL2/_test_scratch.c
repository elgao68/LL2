/////////////////////////////////////////////////////////////////////////////
//
//  _test_scratch.c
//
// Created on: 2024.03.20
// Author: Gabriel Aguirre Ollinger
//
/////////////////////////////////////////////////////////////////////////////

#include <_test_scratch.h>

/////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////
// "SCRATCH" SCRIPT - GAO
/////////////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

void
test_scratch() {

	/////////////////////////////////////////////////////////////////////////////
	// Test console:
	/////////////////////////////////////////////////////////////////////////////

	int i = 0;
	for (i = 1; i <= 10; i++) {
		printf("foo[%d]\n", i);
		HAL_Delay(100);
	}
	printf("\n");

	/////////////////////////////////////////////////////////////////////////////
	// Matrix multiplication:
	/////////////////////////////////////////////////////////////////////////////

	double a[] = {
			0.11, 0.12, 0.13,
			0.21, 0.22, 0.23 };
	double b[] = {
			1011, 1012,
			1021, 1022,
			1031, 1032 };

	nml_mat* A = nml_mat_from(2, 3, 6, a);
	nml_mat* B = nml_mat_from(3, 2, 6, b);

	// Multiply matrices
	nml_mat* C = nml_mat_dot(A, B);

	double CC[4];

	CC[0] = C->data[0][0];
	CC[1] = C->data[0][1];

	CC[2] = C->data[1][0];
	CC[3] = C->data[1][1];

	nml_mat* D = nml_mat_sqr(4);

	/////////////////////////////////////////////////////////////////////////////
	// Solve linear system:
	/////////////////////////////////////////////////////////////////////////////

	double a_data[] = {
		0.18, 0.60, 0.57, 0.96,
		0.41, 0.24, 0.99, 0.58,
		0.14, 0.30, 0.97, 0.66,
		0.51, 0.13, 0.19, 0.85 };

	double b_data[] = { 1.0, 2.0, 3.0, 4.0 };

	nml_mat* A_sys = nml_mat_from(4, 4, 16, a_data);
	nml_mat* b_sys = nml_mat_from(4, 1,  4, b_data);

	nml_mat_lup* A_LUP = nml_mat_lup_solve(A_sys);
	nml_mat*     x     = nml_ls_solve(A_LUP, b_sys);

	double xx[4];

	xx[0] = x->data[0][0];
	xx[1] = x->data[1][0];
	xx[2] = x->data[2][0];
	xx[3] = x->data[3][0];

	nml_mat* E = nml_mat_sqr(4);

	int r_i, c_i;
	for (r_i = 0; r_i < 2; r_i++) {
		printf("\n");
		for (c_i = 0; c_i < 2; c_i++) {
			printf("C[%d][%d] = %f\n", r_i, c_i, C->data[r_i][c_i]);
			HAL_Delay(100);
			// fflush(stdout);
		}
	}
}
